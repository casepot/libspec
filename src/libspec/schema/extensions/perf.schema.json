{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://libspec.dev/schema/1.0/extensions/perf.schema.json",
  "title": "Performance Extension",
  "description": "Extension for performance characteristics: complexity, benchmarks, scaling.",

  "$defs": {
    "PerfMethodFields": {
      "description": "Fields added to Method when perf extension is active",
      "type": "object",
      "properties": {
        "complexity": {
          "$ref": "#/$defs/ComplexitySpec"
        },
        "benchmarks": {
          "type": "array",
          "items": { "$ref": "#/$defs/BenchmarkSpec" }
        },
        "optimization_hints": {
          "type": "array",
          "description": "Tips for optimal usage",
          "items": { "type": "string" }
        }
      }
    },

    "PerfFunctionFields": {
      "description": "Fields added to FunctionDef when perf extension is active",
      "type": "object",
      "properties": {
        "complexity": {
          "$ref": "#/$defs/ComplexitySpec"
        },
        "benchmarks": {
          "type": "array",
          "items": { "$ref": "#/$defs/BenchmarkSpec" }
        },
        "optimization_hints": {
          "type": "array",
          "description": "Tips for optimal usage",
          "items": { "type": "string" }
        }
      }
    },

    "PerfTypeFields": {
      "description": "Fields added to TypeDef when perf extension is active",
      "type": "object",
      "properties": {
        "memory_layout": {
          "$ref": "#/$defs/MemoryLayoutSpec"
        },
        "scaling": {
          "$ref": "#/$defs/ScalingSpec"
        }
      }
    },

    "ComplexitySpec": {
      "type": "object",
      "description": "Computational complexity specification",
      "properties": {
        "time": {
          "type": "string",
          "description": "Time complexity (e.g., 'O(n log n)')"
        },
        "space": {
          "type": "string",
          "description": "Space complexity (e.g., 'O(n)')"
        },
        "best_case": {
          "type": "string",
          "description": "Best-case time complexity"
        },
        "worst_case": {
          "type": "string",
          "description": "Worst-case time complexity"
        },
        "amortized": {
          "type": "string",
          "description": "Amortized time complexity"
        },
        "notes": {
          "type": "string",
          "description": "Additional notes about complexity"
        }
      }
    },

    "BenchmarkSpec": {
      "type": "object",
      "description": "Performance benchmark data",
      "properties": {
        "operation": {
          "type": "string",
          "description": "What was benchmarked"
        },
        "input_size": {
          "type": "string",
          "description": "Input size/parameters"
        },
        "mean": {
          "type": "string",
          "description": "Mean execution time"
        },
        "median": {
          "type": "string",
          "description": "Median execution time"
        },
        "p95": {
          "type": "string",
          "description": "95th percentile latency"
        },
        "p99": {
          "type": "string",
          "description": "99th percentile latency"
        },
        "memory_peak": {
          "type": "string",
          "description": "Peak memory usage"
        },
        "throughput": {
          "type": "string",
          "description": "Operations per second"
        },
        "environment": {
          "type": "string",
          "description": "Hardware/software environment"
        },
        "date": {
          "type": "string",
          "description": "When benchmark was run",
          "format": "date"
        }
      }
    },

    "MemoryLayoutSpec": {
      "type": "object",
      "description": "Memory layout characteristics",
      "properties": {
        "size_bytes": {
          "type": "integer",
          "description": "Instance size in bytes",
          "minimum": 0
        },
        "alignment": {
          "type": "integer",
          "description": "Memory alignment requirement"
        },
        "cache_friendly": {
          "type": "boolean",
          "description": "Whether layout is cache-optimized"
        },
        "slots": {
          "type": "boolean",
          "description": "Whether __slots__ is used"
        }
      }
    },

    "ScalingSpec": {
      "type": "object",
      "description": "Scaling characteristics",
      "properties": {
        "horizontal": {
          "type": "boolean",
          "description": "Supports horizontal scaling"
        },
        "vertical": {
          "type": "boolean",
          "description": "Supports vertical scaling"
        },
        "bottleneck": {
          "type": "string",
          "description": "Primary scaling bottleneck"
        },
        "max_concurrent": {
          "type": "integer",
          "description": "Maximum concurrent operations"
        },
        "sharding_supported": {
          "type": "boolean",
          "description": "Whether sharding is supported"
        }
      }
    }
  }
}
