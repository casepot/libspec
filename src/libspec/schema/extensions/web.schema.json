{
  "$defs": {
    "AppliesTo": {
      "description": "Which routes middleware applies to.\n\n- all: Applies to all routes\n- tagged: Applies to routes with matching tags\n- specific: Applies to explicitly listed routes",
      "enum": [
        "all",
        "tagged",
        "specific"
      ],
      "title": "AppliesTo",
      "type": "string"
    },
    "Auth": {
      "description": "Authentication requirement level for a route.\n\n- required: Authentication is mandatory\n- optional: Route works with or without authentication\n- none: No authentication needed",
      "enum": [
        "required",
        "optional",
        "none"
      ],
      "title": "Auth",
      "type": "string"
    },
    "DependencySpec": {
      "properties": {
        "async": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether factory is async",
          "title": "Async"
        },
        "cacheable": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": true,
          "description": "Whether result can be cached",
          "title": "Cacheable"
        },
        "dependencies": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Other dependencies this requires",
          "title": "Dependencies"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "factory": {
          "anyOf": [
            {
              "minLength": 1,
              "pattern": "^[a-z_][a-z0-9_.]*$",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Factory function reference",
          "title": "Factory"
        },
        "name": {
          "description": "Dependency name",
          "minLength": 1,
          "title": "Name",
          "type": "string"
        },
        "scope": {
          "anyOf": [
            {
              "$ref": "#/$defs/Scope"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Dependency lifetime"
        },
        "type": {
          "description": "Dependency type",
          "title": "Type",
          "type": "string"
        }
      },
      "required": [
        "name",
        "type"
      ],
      "title": "DependencySpec",
      "type": "object"
    },
    "Direction": {
      "description": "WebSocket message flow direction.\n\n- client_to_server: Client sends to server only\n- server_to_client: Server sends to client only\n- bidirectional: Messages flow both ways",
      "enum": [
        "client_to_server",
        "server_to_client",
        "bidirectional"
      ],
      "title": "Direction",
      "type": "string"
    },
    "ErrorHandlerSpec": {
      "properties": {
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "exception": {
          "description": "Exception type to handle",
          "title": "Exception",
          "type": "string"
        },
        "handler": {
          "anyOf": [
            {
              "minLength": 1,
              "pattern": "^[a-z_][a-z0-9_.]*$",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Custom handler function",
          "title": "Handler"
        },
        "response_type": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Response model type",
          "title": "Response Type"
        },
        "status": {
          "description": "HTTP status code",
          "maximum": 599,
          "minimum": 100,
          "title": "Status",
          "type": "integer"
        }
      },
      "required": [
        "exception",
        "status"
      ],
      "title": "ErrorHandlerSpec",
      "type": "object"
    },
    "ErrorResponseSpec": {
      "properties": {
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "exception": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Exception type that triggers this response",
          "title": "Exception"
        },
        "status": {
          "description": "HTTP status code",
          "maximum": 599,
          "minimum": 100,
          "title": "Status",
          "type": "integer"
        },
        "type": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Error response model type",
          "title": "Type"
        },
        "when": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "When this error occurs",
          "title": "When"
        }
      },
      "required": [
        "status"
      ],
      "title": "ErrorResponseSpec",
      "type": "object"
    },
    "HeaderSpec": {
      "properties": {
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "name": {
          "description": "Header name",
          "minLength": 1,
          "title": "Name",
          "type": "string"
        },
        "required": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": false,
          "title": "Required"
        },
        "type": {
          "anyOf": [
            {
              "minLength": 1,
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Value type",
          "title": "Type"
        }
      },
      "required": [
        "name"
      ],
      "title": "HeaderSpec",
      "type": "object"
    },
    "Method": {
      "description": "HTTP request methods.\n\nStandard methods plus wildcard for matching any method.",
      "enum": [
        "get",
        "post",
        "put",
        "delete",
        "patch",
        "head",
        "options",
        "*"
      ],
      "title": "Method",
      "type": "string"
    },
    "MiddlewareSpec": {
      "properties": {
        "applies_to": {
          "anyOf": [
            {
              "$ref": "#/$defs/AppliesTo"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Which routes this applies to"
        },
        "config": {
          "anyOf": [
            {
              "additionalProperties": true,
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Middleware configuration",
          "title": "Config"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "name": {
          "description": "Middleware name",
          "minLength": 1,
          "title": "Name",
          "type": "string"
        },
        "order": {
          "anyOf": [
            {
              "minimum": 0,
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Execution order (lower = earlier)",
          "title": "Order"
        },
        "position": {
          "anyOf": [
            {
              "$ref": "#/$defs/Position"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "When middleware runs"
        },
        "routes": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Route paths (if applies_to='specific')",
          "title": "Routes"
        },
        "tags": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Tags to match (if applies_to='tagged')",
          "title": "Tags"
        },
        "type": {
          "anyOf": [
            {
              "minLength": 1,
              "pattern": "^[a-z_][a-z0-9_.]*$",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Middleware class/function reference",
          "title": "Type"
        }
      },
      "required": [
        "name"
      ],
      "title": "MiddlewareSpec",
      "type": "object"
    },
    "PathParamSpec": {
      "properties": {
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "name": {
          "description": "Parameter name in path",
          "minLength": 1,
          "title": "Name",
          "type": "string"
        },
        "pattern": {
          "anyOf": [
            {
              "minLength": 1,
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Regex pattern for validation",
          "title": "Pattern"
        },
        "type": {
          "description": "Parameter type",
          "minLength": 1,
          "title": "Type",
          "type": "string"
        }
      },
      "required": [
        "name",
        "type"
      ],
      "title": "PathParamSpec",
      "type": "object"
    },
    "Position": {
      "description": "When middleware runs relative to the request handler.\n\n- before: Runs before the handler\n- after: Runs after the handler\n- wrap: Wraps the handler (runs before and after)",
      "enum": [
        "before",
        "after",
        "wrap"
      ],
      "title": "Position",
      "type": "string"
    },
    "QueryParamSpec": {
      "properties": {
        "default": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Default value",
          "title": "Default"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "multiple": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": false,
          "description": "Whether multiple values allowed",
          "title": "Multiple"
        },
        "name": {
          "description": "Query parameter name",
          "minLength": 1,
          "title": "Name",
          "type": "string"
        },
        "required": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": false,
          "title": "Required"
        },
        "type": {
          "description": "Parameter type",
          "minLength": 1,
          "title": "Type",
          "type": "string"
        }
      },
      "required": [
        "name",
        "type"
      ],
      "title": "QueryParamSpec",
      "type": "object"
    },
    "RateLimitSpec": {
      "properties": {
        "burst": {
          "anyOf": [
            {
              "minimum": 1,
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Burst allowance",
          "title": "Burst"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "key": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Rate limit key (e.g., 'ip', 'user')",
          "title": "Key"
        },
        "requests": {
          "anyOf": [
            {
              "minimum": 1,
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Number of requests allowed",
          "title": "Requests"
        },
        "window": {
          "anyOf": [
            {
              "minLength": 2,
              "pattern": "^[0-9]+(ms|s|m|h|d)$",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Time window (e.g., '1m', '1h')",
          "title": "Window"
        }
      },
      "title": "RateLimitSpec",
      "type": "object"
    },
    "RequestBodySpec": {
      "properties": {
        "content_type": {
          "anyOf": [
            {
              "minLength": 3,
              "pattern": "^[a-z]+/[a-z0-9.+-]+$",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": "application/json",
          "description": "Expected content type",
          "title": "Content Type"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "required": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": true,
          "title": "Required"
        },
        "type": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Request body model type",
          "title": "Type"
        }
      },
      "title": "RequestBodySpec",
      "type": "object"
    },
    "ResponseSpec": {
      "properties": {
        "content_type": {
          "anyOf": [
            {
              "minLength": 3,
              "pattern": "^[a-z]+/[a-z0-9.+-]+$",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": "application/json",
          "description": "Response content type",
          "title": "Content Type"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "headers": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/HeaderSpec"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Response headers",
          "title": "Headers"
        },
        "status": {
          "anyOf": [
            {
              "maximum": 599,
              "minimum": 100,
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": 200,
          "description": "HTTP status code",
          "title": "Status"
        },
        "type": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Response model type",
          "title": "Type"
        }
      },
      "title": "ResponseSpec",
      "type": "object"
    },
    "RouteSpec": {
      "properties": {
        "auth": {
          "anyOf": [
            {
              "$ref": "#/$defs/Auth"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Authentication requirement"
        },
        "deprecated": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether this route is deprecated",
          "title": "Deprecated"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Detailed description",
          "title": "Description"
        },
        "errors": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/ErrorResponseSpec"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Error responses",
          "title": "Errors"
        },
        "handler": {
          "anyOf": [
            {
              "minLength": 1,
              "pattern": "^[a-z_][a-z0-9_.]*$",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Handler function reference",
          "title": "Handler"
        },
        "headers": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/HeaderSpec"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Required/optional header definitions",
          "title": "Headers"
        },
        "method": {
          "$ref": "#/$defs/Method",
          "description": "HTTP method"
        },
        "name": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Route name for URL generation",
          "title": "Name"
        },
        "path": {
          "description": "URL path pattern (e.g., '/users/{user_id}')",
          "minLength": 1,
          "pattern": "^/.*$",
          "title": "Path",
          "type": "string"
        },
        "path_params": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/PathParamSpec"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Path parameter definitions",
          "title": "Path Params"
        },
        "permissions": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Required permissions",
          "title": "Permissions"
        },
        "query_params": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/QueryParamSpec"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Query parameter definitions",
          "title": "Query Params"
        },
        "rate_limit": {
          "anyOf": [
            {
              "$ref": "#/$defs/RateLimitSpec"
            },
            {
              "type": "null"
            }
          ],
          "default": null
        },
        "request_body": {
          "anyOf": [
            {
              "$ref": "#/$defs/RequestBodySpec"
            },
            {
              "type": "null"
            }
          ],
          "default": null
        },
        "response": {
          "anyOf": [
            {
              "$ref": "#/$defs/ResponseSpec"
            },
            {
              "type": "null"
            }
          ],
          "default": null
        },
        "summary": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Short summary for OpenAPI",
          "title": "Summary"
        },
        "tags": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "OpenAPI tags",
          "title": "Tags"
        }
      },
      "required": [
        "path",
        "method"
      ],
      "title": "RouteSpec",
      "type": "object"
    },
    "Scope": {
      "description": "Dependency injection lifetime scope.\n\n- request: New instance per HTTP request\n- session: Shared within a user session\n- app: Shared across the application\n- singleton: Single instance for the app lifetime",
      "enum": [
        "request",
        "session",
        "app",
        "singleton"
      ],
      "title": "Scope",
      "type": "string"
    },
    "WSMessageSpec": {
      "properties": {
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "direction": {
          "$ref": "#/$defs/Direction"
        },
        "name": {
          "description": "Message type name",
          "minLength": 1,
          "title": "Name",
          "type": "string"
        },
        "type": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Message payload type",
          "title": "Type"
        }
      },
      "required": [
        "name",
        "direction"
      ],
      "title": "WSMessageSpec",
      "type": "object"
    },
    "WebLibraryFields": {
      "properties": {
        "dependencies": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/DependencySpec"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Dependency injection definitions",
          "title": "Dependencies"
        },
        "error_handlers": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/ErrorHandlerSpec"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Exception to HTTP response mappings",
          "title": "Error Handlers"
        },
        "middleware": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/MiddlewareSpec"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Middleware stack",
          "title": "Middleware"
        },
        "routes": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/RouteSpec"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "HTTP route definitions",
          "title": "Routes"
        },
        "websockets": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/WebSocketSpec"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "WebSocket endpoint definitions",
          "title": "Websockets"
        }
      },
      "title": "WebLibraryFields",
      "type": "object"
    },
    "WebSocketSpec": {
      "properties": {
        "auth": {
          "anyOf": [
            {
              "$ref": "#/$defs/Auth"
            },
            {
              "type": "null"
            }
          ],
          "default": null
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "handler": {
          "anyOf": [
            {
              "minLength": 1,
              "pattern": "^[a-z_][a-z0-9_.]*$",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Handler function reference",
          "title": "Handler"
        },
        "message_types": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/WSMessageSpec"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Message type definitions",
          "title": "Message Types"
        },
        "path": {
          "description": "WebSocket endpoint path",
          "minLength": 1,
          "pattern": "^/.*$",
          "title": "Path",
          "type": "string"
        },
        "subprotocols": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Supported subprotocols",
          "title": "Subprotocols"
        }
      },
      "required": [
        "path"
      ],
      "title": "WebSocketSpec",
      "type": "object"
    }
  },
  "$id": "https://libspec.dev/schema/1.0/extensions/web.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "Extension for web framework specifications.",
  "title": "Web Extension"
}
