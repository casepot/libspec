{
  "$defs": {
    "Cleanup": {
      "enum": [
        "automatic",
        "manual",
        "context_manager",
        "destructor",
        "ref_counted"
      ],
      "title": "Cleanup",
      "type": "string"
    },
    "ConcurrencyModelSpec": {
      "properties": {
        "deadlock_free": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether deadlocks are impossible by design",
          "title": "Deadlock Free"
        },
        "model": {
          "anyOf": [
            {
              "$ref": "#/$defs/Model"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Concurrency model used"
        },
        "races_possible": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether data races are possible",
          "title": "Races Possible"
        },
        "starvation_free": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether starvation is impossible by design",
          "title": "Starvation Free"
        }
      },
      "title": "ConcurrencyModelSpec",
      "type": "object"
    },
    "Leaks": {
      "enum": [
        "none",
        "possible",
        "managed",
        "external"
      ],
      "title": "Leaks",
      "type": "string"
    },
    "LockGranularity": {
      "enum": [
        "global",
        "per_instance",
        "per_method",
        "fine_grained"
      ],
      "title": "LockGranularity",
      "type": "string"
    },
    "LockType": {
      "enum": [
        "Lock",
        "RLock",
        "RWLock",
        "Semaphore",
        "none"
      ],
      "title": "LockType",
      "type": "string"
    },
    "MemorySafetySpec": {
      "properties": {
        "cleanup": {
          "anyOf": [
            {
              "$ref": "#/$defs/Cleanup"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "How resources are cleaned up"
        },
        "cyclic_refs_safe": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether cyclic references are handled safely",
          "title": "Cyclic Refs Safe"
        },
        "leaks": {
          "anyOf": [
            {
              "$ref": "#/$defs/Leaks"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Memory leak potential"
        },
        "weak_refs_supported": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether weak references are supported",
          "title": "Weak Refs Supported"
        }
      },
      "title": "MemorySafetySpec",
      "type": "object"
    },
    "Model": {
      "enum": [
        "shared_nothing",
        "actor",
        "csp",
        "shared_memory",
        "stm",
        "none"
      ],
      "title": "Model",
      "type": "string"
    },
    "ReentrancySpec": {
      "properties": {
        "reason": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Why it's not reentrant (if applicable)",
          "title": "Reason"
        },
        "reentrant": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether the type/method is reentrant",
          "title": "Reentrant"
        },
        "safe_methods": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Methods that are reentrant even if type isn't",
          "title": "Safe Methods"
        },
        "unsafe_methods": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Methods that are not reentrant even if type is",
          "title": "Unsafe Methods"
        }
      },
      "title": "ReentrancySpec",
      "type": "object"
    },
    "SafetyFunctionFields": {
      "properties": {
        "atomic": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether this operation is atomic",
          "title": "Atomic"
        },
        "reentrant": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether this function is reentrant",
          "title": "Reentrant"
        },
        "signal_safe": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether safe to call from signal handlers",
          "title": "Signal Safe"
        },
        "thread_safe": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether this function is thread-safe",
          "title": "Thread Safe"
        }
      },
      "title": "SafetyFunctionFields",
      "type": "object"
    },
    "SafetyMethodFields": {
      "properties": {
        "atomic": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether this operation is atomic",
          "title": "Atomic"
        },
        "reentrant": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether this method is reentrant",
          "title": "Reentrant"
        },
        "signal_safe": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether safe to call from signal handlers",
          "title": "Signal Safe"
        },
        "thread_safe": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether this method is thread-safe",
          "title": "Thread Safe"
        }
      },
      "title": "SafetyMethodFields",
      "type": "object"
    },
    "SafetyTypeFields": {
      "properties": {
        "concurrency_model": {
          "anyOf": [
            {
              "$ref": "#/$defs/ConcurrencyModelSpec"
            },
            {
              "type": "null"
            }
          ],
          "default": null
        },
        "memory_safety": {
          "anyOf": [
            {
              "$ref": "#/$defs/MemorySafetySpec"
            },
            {
              "type": "null"
            }
          ],
          "default": null
        },
        "reentrancy": {
          "anyOf": [
            {
              "$ref": "#/$defs/ReentrancySpec"
            },
            {
              "type": "null"
            }
          ],
          "default": null
        },
        "thread_safety": {
          "anyOf": [
            {
              "$ref": "#/$defs/ThreadSafetySpec"
            },
            {
              "type": "null"
            }
          ],
          "default": null
        }
      },
      "title": "SafetyTypeFields",
      "type": "object"
    },
    "ThreadSafetyMode": {
      "enum": [
        "immutable",
        "synchronized",
        "thread_local",
        "lock_free",
        "wait_free",
        "none"
      ],
      "title": "ThreadSafetyMode",
      "type": "string"
    },
    "ThreadSafetySpec": {
      "properties": {
        "lock_granularity": {
          "anyOf": [
            {
              "$ref": "#/$defs/LockGranularity"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Granularity of locking"
        },
        "lock_type": {
          "anyOf": [
            {
              "$ref": "#/$defs/LockType"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Type of lock used (if synchronized)"
        },
        "mode": {
          "anyOf": [
            {
              "$ref": "#/$defs/ThreadSafetyMode"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "How thread safety is achieved"
        },
        "notes": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Additional thread safety notes",
          "title": "Notes"
        },
        "safe": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether the type is thread-safe",
          "title": "Safe"
        }
      },
      "title": "ThreadSafetySpec",
      "type": "object"
    }
  },
  "$id": "https://libspec.dev/schema/1.0/extensions/safety.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "Extension for thread safety and concurrency guarantees.",
  "title": "Safety Extension"
}
