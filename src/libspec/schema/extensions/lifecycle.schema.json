{
  "$defs": {
    "ApprovalEvidence": {
      "description": "Approval evidence - requires author.",
      "properties": {
        "author": {
          "minLength": 1,
          "title": "Author",
          "type": "string"
        },
        "date": {
          "anyOf": [
            {
              "format": "date",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Date"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "reference": {
          "anyOf": [
            {
              "format": "path",
              "type": "string"
            },
            {
              "type": "string"
            }
          ],
          "title": "Reference"
        },
        "type": {
          "const": "approval",
          "title": "Type",
          "type": "string"
        }
      },
      "required": [
        "type",
        "reference",
        "author"
      ],
      "title": "ApprovalEvidence",
      "type": "object"
    },
    "BenchmarkEvidence": {
      "description": "Benchmark results evidence.",
      "properties": {
        "author": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Author"
        },
        "date": {
          "anyOf": [
            {
              "format": "date",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Date"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "metrics": {
          "additionalProperties": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "number"
              },
              {
                "type": "string"
              }
            ]
          },
          "title": "Metrics",
          "type": "object"
        },
        "reference": {
          "anyOf": [
            {
              "format": "path",
              "type": "string"
            },
            {
              "type": "string"
            }
          ],
          "title": "Reference"
        },
        "type": {
          "const": "benchmark",
          "title": "Type",
          "type": "string"
        }
      },
      "required": [
        "type",
        "reference"
      ],
      "title": "BenchmarkEvidence",
      "type": "object"
    },
    "CustomEvidence": {
      "description": "Custom evidence type defined in workflow.",
      "properties": {
        "author": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Author"
        },
        "date": {
          "anyOf": [
            {
              "format": "date",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Date"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "path": {
          "anyOf": [
            {
              "format": "path",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Path"
        },
        "reference": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Reference"
        },
        "type": {
          "const": "custom",
          "title": "Type",
          "type": "string"
        },
        "type_name": {
          "minLength": 1,
          "title": "Type Name",
          "type": "string"
        },
        "url": {
          "anyOf": [
            {
              "format": "uri",
              "maxLength": 2083,
              "minLength": 1,
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Url"
        }
      },
      "required": [
        "type",
        "type_name"
      ],
      "title": "CustomEvidence",
      "type": "object"
    },
    "DeprecationNoticeEvidence": {
      "description": "Deprecation notice evidence - requires date.",
      "properties": {
        "date": {
          "description": "Date of the deprecation notice",
          "format": "date",
          "title": "Date",
          "type": "string"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "reference": {
          "minLength": 1,
          "title": "Reference",
          "type": "string"
        },
        "type": {
          "const": "deprecation_notice",
          "title": "Type",
          "type": "string"
        }
      },
      "required": [
        "date",
        "type",
        "reference"
      ],
      "title": "DeprecationNoticeEvidence",
      "type": "object"
    },
    "DesignDocEvidence": {
      "description": "Design document evidence.",
      "properties": {
        "author": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Author"
        },
        "date": {
          "anyOf": [
            {
              "format": "date",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Date"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "reference": {
          "anyOf": [
            {
              "format": "path",
              "type": "string"
            },
            {
              "type": "string"
            }
          ],
          "title": "Reference"
        },
        "type": {
          "const": "design_doc",
          "title": "Type",
          "type": "string"
        }
      },
      "required": [
        "type",
        "reference"
      ],
      "title": "DesignDocEvidence",
      "type": "object"
    },
    "DevStateSpec": {
      "description": "A development lifecycle state.",
      "properties": {
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "name": {
          "minLength": 1,
          "title": "Name",
          "type": "string"
        },
        "order": {
          "anyOf": [
            {
              "minimum": 0,
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Order"
        },
        "required_evidence": {
          "items": {
            "type": "string"
          },
          "title": "Required Evidence",
          "type": "array"
        },
        "terminal": {
          "default": false,
          "title": "Terminal",
          "type": "boolean"
        }
      },
      "required": [
        "name"
      ],
      "title": "DevStateSpec",
      "type": "object"
    },
    "DevTransitionSpec": {
      "description": "A valid state transition with optional gates.",
      "properties": {
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "from_state": {
          "minLength": 1,
          "title": "From State",
          "type": "string"
        },
        "gates": {
          "items": {
            "$ref": "#/$defs/GateSpec"
          },
          "title": "Gates",
          "type": "array"
        },
        "to_state": {
          "minLength": 1,
          "title": "To State",
          "type": "string"
        }
      },
      "required": [
        "from_state",
        "to_state"
      ],
      "title": "DevTransitionSpec",
      "type": "object"
    },
    "DocsEvidence": {
      "description": "Documentation URL evidence.",
      "properties": {
        "date": {
          "anyOf": [
            {
              "format": "date",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Date"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "type": {
          "const": "docs",
          "title": "Type",
          "type": "string"
        },
        "url": {
          "anyOf": [
            {
              "format": "uri",
              "maxLength": 2083,
              "minLength": 1,
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "title": "Url"
        }
      },
      "required": [
        "type",
        "url"
      ],
      "title": "DocsEvidence",
      "type": "object"
    },
    "EvidenceTypeSpec": {
      "description": "Custom evidence type definition for a workflow.",
      "properties": {
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "name": {
          "minLength": 1,
          "title": "Name",
          "type": "string"
        },
        "reference_pattern": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Reference Pattern"
        },
        "required_fields": {
          "items": {
            "enum": [
              "reference",
              "url",
              "path",
              "author",
              "date"
            ],
            "type": "string"
          },
          "title": "Required Fields",
          "type": "array"
        },
        "url_pattern": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Url Pattern"
        }
      },
      "required": [
        "name"
      ],
      "title": "EvidenceTypeSpec",
      "type": "object"
    },
    "GateSpec": {
      "description": "A gate condition for a state transition.",
      "properties": {
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "required": {
          "default": true,
          "title": "Required",
          "type": "boolean"
        },
        "type": {
          "minLength": 1,
          "title": "Type",
          "type": "string"
        },
        "validator": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Validator"
        }
      },
      "required": [
        "type"
      ],
      "title": "GateSpec",
      "type": "object"
    },
    "LifecycleFields": {
      "description": "Fields added to entities when lifecycle extension is active.",
      "properties": {
        "lifecycle_state": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Lifecycle State"
        },
        "state_evidence": {
          "items": {
            "discriminator": {
              "mapping": {
                "approval": "#/$defs/ApprovalEvidence",
                "benchmark": "#/$defs/BenchmarkEvidence",
                "custom": "#/$defs/CustomEvidence",
                "deprecation_notice": "#/$defs/DeprecationNoticeEvidence",
                "design_doc": "#/$defs/DesignDocEvidence",
                "docs": "#/$defs/DocsEvidence",
                "migration_guide": "#/$defs/MigrationGuideEvidence",
                "pr": "#/$defs/PrEvidence",
                "tests": "#/$defs/TestsEvidence"
              },
              "propertyName": "type"
            },
            "oneOf": [
              {
                "$ref": "#/$defs/PrEvidence"
              },
              {
                "$ref": "#/$defs/TestsEvidence"
              },
              {
                "$ref": "#/$defs/DesignDocEvidence"
              },
              {
                "$ref": "#/$defs/DocsEvidence"
              },
              {
                "$ref": "#/$defs/ApprovalEvidence"
              },
              {
                "$ref": "#/$defs/BenchmarkEvidence"
              },
              {
                "$ref": "#/$defs/MigrationGuideEvidence"
              },
              {
                "$ref": "#/$defs/DeprecationNoticeEvidence"
              },
              {
                "$ref": "#/$defs/CustomEvidence"
              }
            ]
          },
          "minItems": 1,
          "title": "State Evidence",
          "type": "array"
        },
        "workflow": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Workflow"
        }
      },
      "title": "LifecycleFields",
      "type": "object"
    },
    "LifecycleLibraryFields": {
      "description": "Fields added to Library when lifecycle extension is active.",
      "properties": {
        "default_workflow": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Default Workflow"
        },
        "workflows": {
          "items": {
            "$ref": "#/$defs/WorkflowSpec"
          },
          "title": "Workflows",
          "type": "array"
        }
      },
      "title": "LifecycleLibraryFields",
      "type": "object"
    },
    "MigrationGuideEvidence": {
      "description": "Migration guide evidence.",
      "properties": {
        "date": {
          "anyOf": [
            {
              "format": "date",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Date"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "reference": {
          "anyOf": [
            {
              "format": "path",
              "type": "string"
            },
            {
              "type": "string"
            }
          ],
          "title": "Reference"
        },
        "type": {
          "const": "migration_guide",
          "title": "Type",
          "type": "string"
        }
      },
      "required": [
        "type",
        "reference"
      ],
      "title": "MigrationGuideEvidence",
      "type": "object"
    },
    "PrEvidence": {
      "description": "Pull/merge request evidence.",
      "properties": {
        "author": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Author"
        },
        "date": {
          "anyOf": [
            {
              "format": "date",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Date"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "type": {
          "const": "pr",
          "title": "Type",
          "type": "string"
        },
        "url": {
          "format": "uri",
          "maxLength": 2083,
          "minLength": 1,
          "title": "Url",
          "type": "string"
        }
      },
      "required": [
        "type",
        "url"
      ],
      "title": "PrEvidence",
      "type": "object"
    },
    "TestsEvidence": {
      "description": "Test file/directory evidence.",
      "properties": {
        "date": {
          "anyOf": [
            {
              "format": "date",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Date"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "path": {
          "format": "path",
          "title": "Path",
          "type": "string"
        },
        "type": {
          "const": "tests",
          "title": "Type",
          "type": "string"
        }
      },
      "required": [
        "type",
        "path"
      ],
      "title": "TestsEvidence",
      "type": "object"
    },
    "WorkflowSpec": {
      "description": "A named workflow defining development lifecycle states and transitions.",
      "properties": {
        "allow_skip": {
          "default": false,
          "title": "Allow Skip",
          "type": "boolean"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "evidence_types": {
          "items": {
            "$ref": "#/$defs/EvidenceTypeSpec"
          },
          "title": "Evidence Types",
          "type": "array"
        },
        "initial_state": {
          "minLength": 1,
          "title": "Initial State",
          "type": "string"
        },
        "name": {
          "minLength": 1,
          "pattern": "^[a-z][a-z0-9]*(-[a-z0-9]+)*$",
          "title": "Name",
          "type": "string"
        },
        "states": {
          "items": {
            "$ref": "#/$defs/DevStateSpec"
          },
          "minItems": 1,
          "title": "States",
          "type": "array"
        },
        "transitions": {
          "items": {
            "$ref": "#/$defs/DevTransitionSpec"
          },
          "title": "Transitions",
          "type": "array"
        }
      },
      "required": [
        "name",
        "states",
        "initial_state"
      ],
      "title": "WorkflowSpec",
      "type": "object"
    }
  },
  "$id": "https://libspec.dev/schema/1.0/extensions/lifecycle.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "Extension for development lifecycle tracking: states, transitions, evidence, workflows.",
  "title": "Lifecycle Extension"
}
