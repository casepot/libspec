{
  "$defs": {
    "ApprovalEvidence": {
      "description": "Approval evidence - requires author.",
      "properties": {
        "author": {
          "minLength": 1,
          "title": "Author",
          "type": "string"
        },
        "date": {
          "anyOf": [
            {
              "format": "date",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Date"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "reference": {
          "anyOf": [
            {
              "format": "path",
              "type": "string"
            },
            {
              "type": "string"
            }
          ],
          "title": "Reference"
        },
        "type": {
          "const": "approval",
          "title": "Type",
          "type": "string"
        }
      },
      "required": [
        "type",
        "reference",
        "author"
      ],
      "title": "ApprovalEvidence",
      "type": "object"
    },
    "BenchmarkEvidence": {
      "description": "Benchmark results evidence.",
      "properties": {
        "author": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Author"
        },
        "date": {
          "anyOf": [
            {
              "format": "date",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Date"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "metrics": {
          "additionalProperties": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "number"
              },
              {
                "type": "string"
              }
            ]
          },
          "title": "Metrics",
          "type": "object"
        },
        "reference": {
          "anyOf": [
            {
              "format": "path",
              "type": "string"
            },
            {
              "type": "string"
            }
          ],
          "title": "Reference"
        },
        "type": {
          "const": "benchmark",
          "title": "Type",
          "type": "string"
        }
      },
      "required": [
        "type",
        "reference"
      ],
      "title": "BenchmarkEvidence",
      "type": "object"
    },
    "CustomEvidence": {
      "description": "Custom evidence type defined in workflow.",
      "properties": {
        "author": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Author"
        },
        "date": {
          "anyOf": [
            {
              "format": "date",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Date"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "path": {
          "anyOf": [
            {
              "format": "path",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Path"
        },
        "reference": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Reference"
        },
        "type": {
          "const": "custom",
          "title": "Type",
          "type": "string"
        },
        "type_name": {
          "minLength": 1,
          "title": "Type Name",
          "type": "string"
        },
        "url": {
          "anyOf": [
            {
              "format": "uri",
              "maxLength": 2083,
              "minLength": 1,
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Url"
        }
      },
      "required": [
        "type",
        "type_name"
      ],
      "title": "CustomEvidence",
      "type": "object"
    },
    "DeprecationNoticeEvidence": {
      "description": "Deprecation notice evidence - requires date.",
      "properties": {
        "date": {
          "description": "Date of the deprecation notice",
          "format": "date",
          "title": "Date",
          "type": "string"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "reference": {
          "minLength": 1,
          "title": "Reference",
          "type": "string"
        },
        "type": {
          "const": "deprecation_notice",
          "title": "Type",
          "type": "string"
        }
      },
      "required": [
        "date",
        "type",
        "reference"
      ],
      "title": "DeprecationNoticeEvidence",
      "type": "object"
    },
    "DesignDocEvidence": {
      "description": "Design document evidence.",
      "properties": {
        "author": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Author"
        },
        "date": {
          "anyOf": [
            {
              "format": "date",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Date"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "reference": {
          "anyOf": [
            {
              "format": "path",
              "type": "string"
            },
            {
              "type": "string"
            }
          ],
          "title": "Reference"
        },
        "type": {
          "const": "design_doc",
          "title": "Type",
          "type": "string"
        }
      },
      "required": [
        "type",
        "reference"
      ],
      "title": "DesignDocEvidence",
      "type": "object"
    },
    "DevStateSpec": {
      "description": "A development lifecycle state.",
      "properties": {
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "name": {
          "minLength": 1,
          "title": "Name",
          "type": "string"
        },
        "order": {
          "anyOf": [
            {
              "minimum": 0,
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Order"
        },
        "required_evidence": {
          "items": {
            "type": "string"
          },
          "title": "Required Evidence",
          "type": "array"
        },
        "terminal": {
          "default": false,
          "title": "Terminal",
          "type": "boolean"
        }
      },
      "required": [
        "name"
      ],
      "title": "DevStateSpec",
      "type": "object"
    },
    "DevTransitionSpec": {
      "description": "A valid state transition with optional gates.",
      "properties": {
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "from_state": {
          "minLength": 1,
          "title": "From State",
          "type": "string"
        },
        "gates": {
          "items": {
            "$ref": "#/$defs/GateSpec"
          },
          "title": "Gates",
          "type": "array"
        },
        "to_state": {
          "minLength": 1,
          "title": "To State",
          "type": "string"
        }
      },
      "required": [
        "from_state",
        "to_state"
      ],
      "title": "DevTransitionSpec",
      "type": "object"
    },
    "DocsEvidence": {
      "description": "Documentation URL evidence.",
      "properties": {
        "date": {
          "anyOf": [
            {
              "format": "date",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Date"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "type": {
          "const": "docs",
          "title": "Type",
          "type": "string"
        },
        "url": {
          "anyOf": [
            {
              "format": "uri",
              "maxLength": 2083,
              "minLength": 1,
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "title": "Url"
        }
      },
      "required": [
        "type",
        "url"
      ],
      "title": "DocsEvidence",
      "type": "object"
    },
    "EntityMaturity": {
      "description": "Development maturity stage of an entity.\n\nUniversal progression tracking for types, functions, features, and methods.\nThis is the single source of truth for \"how developed is this entity?\"\n\nStages represent increasing maturity:\n- idea: Rough concept, may change significantly\n- specified: Behavior described, acceptance criteria clear\n- designed: Shape defined (signatures, contracts, types)\n- implemented: Code exists\n- tested: Tests exist and pass\n- documented: User-facing docs exist\n- released: Part of a public release\n- deprecated: Marked for removal",
      "enum": [
        "idea",
        "specified",
        "designed",
        "implemented",
        "tested",
        "documented",
        "released",
        "deprecated"
      ],
      "title": "EntityMaturity",
      "type": "string"
    },
    "EvidenceTypeSpec": {
      "description": "Custom evidence type definition for a workflow.",
      "properties": {
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "name": {
          "minLength": 1,
          "title": "Name",
          "type": "string"
        },
        "reference_pattern": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Reference Pattern"
        },
        "required_fields": {
          "items": {
            "enum": [
              "reference",
              "url",
              "path",
              "author",
              "date"
            ],
            "type": "string"
          },
          "title": "Required Fields",
          "type": "array"
        },
        "url_pattern": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Url Pattern"
        }
      },
      "required": [
        "name"
      ],
      "title": "EvidenceTypeSpec",
      "type": "object"
    },
    "GateSpec": {
      "description": "A gate condition for a state transition.",
      "properties": {
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "required": {
          "default": true,
          "title": "Required",
          "type": "boolean"
        },
        "type": {
          "minLength": 1,
          "title": "Type",
          "type": "string"
        },
        "validator": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Validator"
        }
      },
      "required": [
        "type"
      ],
      "title": "GateSpec",
      "type": "object"
    },
    "MaturityGate": {
      "description": "A gate for transitioning between maturity levels.\n\nDefines what evidence or approvals are required to advance\nan entity from one maturity level to another.",
      "properties": {
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Human-readable description of this transition",
          "title": "Description"
        },
        "from_maturity": {
          "$ref": "#/$defs/EntityMaturity",
          "description": "Source maturity level"
        },
        "gates": {
          "description": "Required evidence/approval gates",
          "items": {
            "$ref": "#/$defs/GateSpec"
          },
          "title": "Gates",
          "type": "array"
        },
        "to_maturity": {
          "$ref": "#/$defs/EntityMaturity",
          "description": "Target maturity level"
        }
      },
      "required": [
        "from_maturity",
        "to_maturity"
      ],
      "title": "MaturityGate",
      "type": "object"
    },
    "MigrationGuideEvidence": {
      "description": "Migration guide evidence.",
      "properties": {
        "date": {
          "anyOf": [
            {
              "format": "date",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Date"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "reference": {
          "anyOf": [
            {
              "format": "path",
              "type": "string"
            },
            {
              "type": "string"
            }
          ],
          "title": "Reference"
        },
        "type": {
          "const": "migration_guide",
          "title": "Type",
          "type": "string"
        }
      },
      "required": [
        "type",
        "reference"
      ],
      "title": "MigrationGuideEvidence",
      "type": "object"
    },
    "PrEvidence": {
      "description": "Pull/merge request evidence.",
      "properties": {
        "author": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Author"
        },
        "date": {
          "anyOf": [
            {
              "format": "date",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Date"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "type": {
          "const": "pr",
          "title": "Type",
          "type": "string"
        },
        "url": {
          "format": "uri",
          "maxLength": 2083,
          "minLength": 1,
          "title": "Url",
          "type": "string"
        }
      },
      "required": [
        "type",
        "url"
      ],
      "title": "PrEvidence",
      "type": "object"
    },
    "TestsEvidence": {
      "description": "Test file/directory evidence.",
      "properties": {
        "date": {
          "anyOf": [
            {
              "format": "date",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Date"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "path": {
          "format": "path",
          "title": "Path",
          "type": "string"
        },
        "type": {
          "const": "tests",
          "title": "Type",
          "type": "string"
        }
      },
      "required": [
        "type",
        "path"
      ],
      "title": "TestsEvidence",
      "type": "object"
    },
    "WorkflowFields": {
      "description": "Fields added to entities when workflow extension is active.\n\nNote: The `maturity` field on core entities is the primary way to track\ndevelopment progress. This extension adds workflow orchestration and\nevidence tracking on top of maturity.\n\nFields:\n    workflow: Optional workflow override for this entity\n    maturity_evidence: Evidence supporting current maturity level\n    workflow_state: (Legacy) Arbitrary workflow state, use maturity instead\n    state_evidence: (Legacy) Alias for maturity_evidence",
      "properties": {
        "maturity_evidence": {
          "items": {
            "discriminator": {
              "mapping": {
                "approval": "#/$defs/ApprovalEvidence",
                "benchmark": "#/$defs/BenchmarkEvidence",
                "custom": "#/$defs/CustomEvidence",
                "deprecation_notice": "#/$defs/DeprecationNoticeEvidence",
                "design_doc": "#/$defs/DesignDocEvidence",
                "docs": "#/$defs/DocsEvidence",
                "migration_guide": "#/$defs/MigrationGuideEvidence",
                "pr": "#/$defs/PrEvidence",
                "tests": "#/$defs/TestsEvidence"
              },
              "propertyName": "type"
            },
            "oneOf": [
              {
                "$ref": "#/$defs/PrEvidence"
              },
              {
                "$ref": "#/$defs/TestsEvidence"
              },
              {
                "$ref": "#/$defs/DesignDocEvidence"
              },
              {
                "$ref": "#/$defs/DocsEvidence"
              },
              {
                "$ref": "#/$defs/ApprovalEvidence"
              },
              {
                "$ref": "#/$defs/BenchmarkEvidence"
              },
              {
                "$ref": "#/$defs/MigrationGuideEvidence"
              },
              {
                "$ref": "#/$defs/DeprecationNoticeEvidence"
              },
              {
                "$ref": "#/$defs/CustomEvidence"
              }
            ]
          },
          "title": "Maturity Evidence",
          "type": "array"
        },
        "state_evidence": {
          "description": "Legacy: use maturity_evidence instead",
          "items": {
            "discriminator": {
              "mapping": {
                "approval": "#/$defs/ApprovalEvidence",
                "benchmark": "#/$defs/BenchmarkEvidence",
                "custom": "#/$defs/CustomEvidence",
                "deprecation_notice": "#/$defs/DeprecationNoticeEvidence",
                "design_doc": "#/$defs/DesignDocEvidence",
                "docs": "#/$defs/DocsEvidence",
                "migration_guide": "#/$defs/MigrationGuideEvidence",
                "pr": "#/$defs/PrEvidence",
                "tests": "#/$defs/TestsEvidence"
              },
              "propertyName": "type"
            },
            "oneOf": [
              {
                "$ref": "#/$defs/PrEvidence"
              },
              {
                "$ref": "#/$defs/TestsEvidence"
              },
              {
                "$ref": "#/$defs/DesignDocEvidence"
              },
              {
                "$ref": "#/$defs/DocsEvidence"
              },
              {
                "$ref": "#/$defs/ApprovalEvidence"
              },
              {
                "$ref": "#/$defs/BenchmarkEvidence"
              },
              {
                "$ref": "#/$defs/MigrationGuideEvidence"
              },
              {
                "$ref": "#/$defs/DeprecationNoticeEvidence"
              },
              {
                "$ref": "#/$defs/CustomEvidence"
              }
            ]
          },
          "title": "State Evidence",
          "type": "array"
        },
        "workflow": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Workflow"
        },
        "workflow_state": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Legacy: use core maturity field instead",
          "title": "Workflow State"
        }
      },
      "title": "WorkflowFields",
      "type": "object"
    },
    "WorkflowLibraryFields": {
      "description": "Fields added to Library when workflow extension is active.",
      "properties": {
        "default_workflow": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Default Workflow"
        },
        "workflows": {
          "items": {
            "$ref": "#/$defs/WorkflowSpec"
          },
          "title": "Workflows",
          "type": "array"
        }
      },
      "title": "WorkflowLibraryFields",
      "type": "object"
    },
    "WorkflowSpec": {
      "description": "A named workflow defining development lifecycle states and transitions.\n\nWorkflows can define gates in two ways:\n1. State-based (legacy): Using `states` and `transitions` for arbitrary workflow states\n2. Maturity-based: Using `maturity_gates` for EntityMaturity level transitions\n\nThe maturity-based approach is recommended as it aligns with the core\nmaturity field on entities.",
      "properties": {
        "allow_skip": {
          "default": false,
          "title": "Allow Skip",
          "type": "boolean"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Description"
        },
        "evidence_types": {
          "items": {
            "$ref": "#/$defs/EvidenceTypeSpec"
          },
          "title": "Evidence Types",
          "type": "array"
        },
        "initial_state": {
          "anyOf": [
            {
              "minLength": 1,
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Initial State"
        },
        "maturity_gates": {
          "description": "Gates for maturity level transitions",
          "items": {
            "$ref": "#/$defs/MaturityGate"
          },
          "title": "Maturity Gates",
          "type": "array"
        },
        "name": {
          "minLength": 1,
          "pattern": "^[a-z][a-z0-9]*(-[a-z0-9]+)*$",
          "title": "Name",
          "type": "string"
        },
        "states": {
          "items": {
            "$ref": "#/$defs/DevStateSpec"
          },
          "title": "States",
          "type": "array"
        },
        "transitions": {
          "items": {
            "$ref": "#/$defs/DevTransitionSpec"
          },
          "title": "Transitions",
          "type": "array"
        }
      },
      "required": [
        "name"
      ],
      "title": "WorkflowSpec",
      "type": "object"
    }
  },
  "$id": "https://libspec.dev/schema/1.0/extensions/workflow.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "Extension for development workflow tracking: states, transitions, evidence, gates.",
  "title": "Workflow Extension"
}
