{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://libspec.dev/schema/1.0/extensions/cli.schema.json",
  "title": "CLI Extension",
  "description": "Extension for command-line interfaces: commands, arguments, options, subcommands.",

  "$defs": {
    "CLILibraryFields": {
      "description": "Fields added to Library when CLI extension is active",
      "type": "object",
      "properties": {
        "cli_name": {
          "type": "string",
          "description": "CLI executable name"
        },
        "commands": {
          "type": "array",
          "description": "CLI commands",
          "items": { "$ref": "#/$defs/CommandSpec" }
        },
        "global_options": {
          "type": "array",
          "description": "Options available to all commands",
          "items": { "$ref": "#/$defs/OptionSpec" }
        },
        "shell_completion": {
          "$ref": "#/$defs/ShellCompletionSpec"
        },
        "help_formatting": {
          "$ref": "#/$defs/HelpFormattingSpec"
        },
        "exit_codes": {
          "type": "array",
          "description": "Exit code definitions",
          "items": { "$ref": "#/$defs/ExitCodeSpec" }
        }
      }
    },

    "CommandSpec": {
      "type": "object",
      "description": "A CLI command definition",
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Command name"
        },
        "aliases": {
          "type": "array",
          "description": "Command aliases",
          "items": { "type": "string" }
        },
        "handler": {
          "type": "string",
          "description": "Handler function reference"
        },
        "arguments": {
          "type": "array",
          "description": "Positional arguments",
          "items": { "$ref": "#/$defs/ArgumentSpec" }
        },
        "options": {
          "type": "array",
          "description": "Command options/flags",
          "items": { "$ref": "#/$defs/OptionSpec" }
        },
        "subcommands": {
          "type": "array",
          "description": "Subcommands",
          "items": { "$ref": "#/$defs/CommandSpec" }
        },
        "help": {
          "type": "string",
          "description": "Help text"
        },
        "short_help": {
          "type": "string",
          "description": "Short help shown in command listings"
        },
        "epilog": {
          "type": "string",
          "description": "Text shown after help"
        },
        "hidden": {
          "type": "boolean",
          "description": "Whether command is hidden from help"
        },
        "deprecated": {
          "type": "boolean",
          "description": "Whether command is deprecated"
        },
        "deprecated_message": {
          "type": "string",
          "description": "Deprecation message"
        },
        "examples": {
          "type": "array",
          "description": "Usage examples",
          "items": { "$ref": "#/$defs/ExampleSpec" }
        },
        "context_settings": {
          "$ref": "#/$defs/ContextSettingsSpec"
        }
      }
    },

    "ArgumentSpec": {
      "type": "object",
      "description": "A positional argument",
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Argument name"
        },
        "type": {
          "type": "string",
          "description": "Argument type"
        },
        "required": {
          "type": "boolean",
          "description": "Whether argument is required",
          "default": true
        },
        "default": {
          "description": "Default value"
        },
        "nargs": {
          "type": ["integer", "string"],
          "description": "Number of arguments (int, '?', '*', '+')"
        },
        "metavar": {
          "type": "string",
          "description": "Display name in help"
        },
        "help": {
          "type": "string",
          "description": "Help text"
        },
        "envvar": {
          "type": "string",
          "description": "Environment variable fallback"
        },
        "shell_complete": {
          "$ref": "#/$defs/CompletionSpec"
        }
      }
    },

    "OptionSpec": {
      "type": "object",
      "description": "A command option/flag",
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Long option name (e.g., '--verbose')"
        },
        "short": {
          "type": "string",
          "description": "Short option name (e.g., '-v')"
        },
        "type": {
          "type": "string",
          "description": "Option type"
        },
        "required": {
          "type": "boolean",
          "description": "Whether option is required",
          "default": false
        },
        "default": {
          "description": "Default value"
        },
        "is_flag": {
          "type": "boolean",
          "description": "Whether this is a boolean flag"
        },
        "flag_value": {
          "description": "Value when flag is set"
        },
        "count": {
          "type": "boolean",
          "description": "Whether to count occurrences (e.g., -vvv)"
        },
        "multiple": {
          "type": "boolean",
          "description": "Whether option can be repeated"
        },
        "choices": {
          "type": "array",
          "description": "Valid choices",
          "items": {}
        },
        "metavar": {
          "type": "string",
          "description": "Display name in help"
        },
        "help": {
          "type": "string",
          "description": "Help text"
        },
        "hidden": {
          "type": "boolean",
          "description": "Whether option is hidden from help"
        },
        "envvar": {
          "type": "string",
          "description": "Environment variable name"
        },
        "prompt": {
          "type": ["boolean", "string"],
          "description": "Whether to prompt if not provided"
        },
        "confirmation_prompt": {
          "type": "boolean",
          "description": "Whether to confirm input"
        },
        "hide_input": {
          "type": "boolean",
          "description": "Whether to hide input (for passwords)"
        },
        "show_default": {
          "type": "boolean",
          "description": "Whether to show default in help"
        },
        "show_envvar": {
          "type": "boolean",
          "description": "Whether to show envvar in help"
        },
        "shell_complete": {
          "$ref": "#/$defs/CompletionSpec"
        }
      }
    },

    "ExampleSpec": {
      "type": "object",
      "description": "A usage example",
      "properties": {
        "command": {
          "type": "string",
          "description": "Example command line"
        },
        "description": {
          "type": "string",
          "description": "What this example demonstrates"
        },
        "output": {
          "type": "string",
          "description": "Expected output"
        }
      }
    },

    "ExitCodeSpec": {
      "type": "object",
      "description": "An exit code definition",
      "required": ["code"],
      "properties": {
        "code": {
          "type": "integer",
          "description": "Exit code value"
        },
        "name": {
          "type": "string",
          "description": "Exit code name"
        },
        "description": {
          "type": "string",
          "description": "When this code is returned"
        }
      }
    },

    "ShellCompletionSpec": {
      "type": "object",
      "description": "Shell completion configuration",
      "properties": {
        "shells": {
          "type": "array",
          "description": "Supported shells",
          "items": {
            "type": "string",
            "enum": ["bash", "zsh", "fish", "powershell"]
          }
        },
        "install_command": {
          "type": "string",
          "description": "Command to install completions"
        },
        "env_var": {
          "type": "string",
          "description": "Environment variable for completion script"
        }
      }
    },

    "CompletionSpec": {
      "type": "object",
      "description": "Completion configuration for an argument/option",
      "properties": {
        "type": {
          "type": "string",
          "description": "Completion type",
          "enum": ["path", "file", "directory", "choice", "dynamic", "none"]
        },
        "function": {
          "type": "string",
          "description": "Custom completion function reference"
        },
        "file_pattern": {
          "type": "string",
          "description": "File pattern for path completion"
        }
      }
    },

    "HelpFormattingSpec": {
      "type": "object",
      "description": "Help formatting configuration",
      "properties": {
        "max_width": {
          "type": "integer",
          "description": "Maximum help text width"
        },
        "show_default": {
          "type": "boolean",
          "description": "Show defaults in help by default"
        },
        "show_envvar": {
          "type": "boolean",
          "description": "Show env vars in help by default"
        },
        "rich_markup": {
          "type": "boolean",
          "description": "Whether rich markup is supported"
        },
        "color": {
          "type": "string",
          "description": "Color support",
          "enum": ["auto", "always", "never"]
        }
      }
    },

    "ContextSettingsSpec": {
      "type": "object",
      "description": "Command context settings",
      "properties": {
        "allow_extra_args": {
          "type": "boolean",
          "description": "Whether extra arguments are allowed"
        },
        "allow_interspersed_args": {
          "type": "boolean",
          "description": "Whether args can be mixed with options"
        },
        "ignore_unknown_options": {
          "type": "boolean",
          "description": "Whether unknown options are ignored"
        },
        "auto_envvar_prefix": {
          "type": "string",
          "description": "Auto-generate envvar names with prefix"
        },
        "token_normalize_func": {
          "type": "string",
          "description": "Function to normalize tokens"
        }
      }
    }
  }
}
